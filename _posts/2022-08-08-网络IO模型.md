---
redirect_from: /_posts/2022-08-08-网络IO模型/
title: I/O模型
tags:
  - Netty
  - I/O模型
---

## UNIX的5中I/O模型
根据UNIX网络编程对I/O模型的分类，UNIX提供了5种模型。

模型 | 简介
-- | --
阻塞I/O | 最常用的阻塞模型，默认所有文件操作都是阻塞的。
非阻塞I/O | 应用调用时，如果缓冲区没有数据就返回EWOULDBLOCK。之后一直轮询查看数据是否准备好了。
I/O复用 | Linux提供select/poll，进程将一个或多个fd(文件描述符)传递给select/poll系统。这样select/poll系统就可以监控多个fd的状态是否就绪，select/poll顺序扫描优先处理已就绪的fd。当然select/poll系统一次监控的fd也是有数量限制的。Linux还提供了epoll系统，已事件驱动的方式代替了顺序扫描，大幅提高了性能，当fd处于就绪状态时触发回调rollback函数。 
信号驱动I/O | 首先开启套接口信号驱动I/O功能，此时系统会执行一个信号处理函数。当数据准备就绪后就会发送一个SIGIO信号，通知应用来读取数据。
异步I/O | 告知内核启动某个操作，然后动作完成后通知我们。与信号驱动的区别是，信号驱动I/O是内核告知我们I/O操作什么时候可以开始，而异步I/O是告诉我们操作什么时候完成。 

## I/O多路复用技术
I/O复用技术就是把多个I/O阻塞复用到一个select阻塞上。从而是的一个单线程可以处理多个客户端的请求，减少了系统的开销，系统不必再去创建一个进程或线程处理。

Linux一开始很长一段时间都是采用了，select轮询和网络事件通知的方式处理请求。但是由于select一些固有的缺陷导致应用收到了很大限制。最后Linux找到了epoll作为替代方案。

### epoll方式
1. 支持一个进程打开的fd不受限制(select方式下限制了fd最大数量)，仅受限于操作系统的最大文件句柄数量。select单个线程下默认限制了fd最大数量为1024，可以通过修改FD_SETSIZE参数进行修改，但是会带来网络性能下降的问题，这对于大型服务器显然是不能接收的。
2. I/O效率不会因fd数量增加而线性下降。因为select采用的轮询方式，而epoll只会关心那些活跃的进程。
3. 使用mmap加速内核和用户空间的通讯。select和poll是将内核数据复制到用户空间，而mmap是直接将内核数据地址交给了用户空间，用户空间就可以和内核共享这块地址。
4. epoll的API更加简单。

值得注意的是，epoll只是Linux克服select/poll的一种解决方案。现在也有很多其他的解决方案，其他还有像freeBSD下的kqueue方式等。

